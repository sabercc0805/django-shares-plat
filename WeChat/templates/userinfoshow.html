{% extends 'userinfonew.html' %}
{% load staticfiles %}
{% block title %}{{ contentname }}{% endblock %}
{% block css %}
    <link rel="stylesheet" href="{% static 'css/userinfo.css' %}">

    <style>
         .class-button{
        background-color:white;
        outline: none;
        color: black;
        border-width: 1px;
        border-color:rgba(0,0,0,0);
        border-Radius:0px;
        font-size: 18px;
    }

         .class-button.active{
        background-color:white;
        outline: none;
        color: darkred;
       border-width: 0px;
        border-color:rgba(0,0,0,0);
        border-Radius:0px;
        font-size: 18px;
        box-shadow: none;
    }

    .class-button:hover{
        background-color:white;
        outline: none;
        color: darkred;
       border-width: 0px;
        border-color:whitesmoke;
        border-Radius:0px;
        font-size: 18px;
    }

    .class-button:focus{
        background-color:white;
        outline: none;
        color: darkred;
       border-width: 0px;
        border-color:whitesmoke;
        border-Radius:0px;
        font-size: 18px;
    }

     .sign-button{
        background-color:white;
        outline: none;
        color: darkred;
        border-width: 1px;
        border-color:darkred;
        border-Radius:3px;
        font-size: 18px;
    }
    .sign-button:hover{
        background-color:darkred;
        outline: none;
        color: white;
       border-width: 1px;
        border-color:darkred;
        border-Radius:3px;
        font-size: 18px;
    }

    .sign-button:focus{
        background-color:darkred;
        outline: none;
        color: white;
       border-width: 1px;
        border-color:darkred;
        border-Radius:3px;
        font-size: 18px;
    }

     .jiaocheng-button{
        background-color:rgba(0,0,0,0);
        outline: none;
        color: white;
        border-width: 0px;
        border-color:rgba(0,0,0,0);
        border-Radius:0px;
        font-size: 18px;
    }
    .jiaocheng-button:hover{
        background-color:rgba(0,0,0,0);
        outline: none;
        color: darkred;
       border-width: 0px;
        border-color:whitesmoke;
        border-Radius:0px;
        font-size: 18px;
    }

    .jiaocheng-button:focus{
        background-color:rgba(0,0,0,0);
        outline: none;
        color: darkred;
       border-width: 0px;
        border-color:whitesmoke;
        border-Radius:0px;
        font-size: 18px;
    }

    .class-h4{
        background-color:white;
        outline: none;
        color: black;
        border-width: 1px;
        border-color:rgba(0,0,0,0);
        border-Radius:0px;
        font-size: 20px;
        font-weight:bold;
    }
     ul li{list-style: none}
    </style>
{% endblock %}

{% block exchangecontent %}
    <div class="row clearfix">
        <div class="row clearfix">
            {% if errortype == 0 %}
                <div id="myAlert1" class="alert alert-success center-block">
                    <a href="#" class="close" data-dismiss="alert">&times;</a>
                    <strong>成功！</strong>修改密码成功。
                </div>
            {% elif errortype == 1 %}
                <div id="myAlert2" class="alert alert-danger center-block">
                    <a href="#" class="close" data-dismiss="alert">&times;</a>
                    <strong>失败！</strong>原密码错误。
                </div>
            {% elif errortype == 2 %}
                <div id="myAlert3" class="alert alert-danger center-block">
                    <a href="#" class="close" data-dismiss="alert">&times;</a>
                    <strong>失败！</strong>两次输入密码长度不同。
                </div>
           {% endif %}
        </div>

        <div class="row clearfix" style="height:300px;background-color: #FFFFFF;">
            <div class="col-md-3" style="height:320px;background-color: gold;margin-top:-10px;margin-bottom:-30px;box-shadow:3px 3px 8px gray;">
                <br>
                <br>
                <a style="border-color: rgba(0,0,0,0)" href="#" data-toggle="modal" data-target="#picmodel"> <img src="{% static 'images/login.jpg' %}" class="img-circle center-block" alt="140x140" width="140px" height="140px" style="box-shadow:-2px 0px 8px #f00,0px -2px 8px #000,0px 2px 8px #9e038a,2px 0px 8px #0f0;"/></a>
                <h2 class="text-center" style="font-weight: bolder">{{ User.userid }}</h2>
                <div class="row clearfix" style="background-color: black;position: absolute;bottom: 0px;height: 70px;width: 100%;">
                    <div class="row">
                        <h5 class="text-center" style="color: #FFFFFF">石缝芽数据欢迎您！</h5>
                    </div>
                    <a class="btn jiaocheng-button center-block" href="/article/">前往教程<span class="glyphicon glyphicon-hand-right"></span></a>
                </div>
            </div>
            <div class="col-md-6">
                <h3>我的钱包</h3>
                <HR>
                <div class="col-md-6">
                    <div class="row">
                        <h3 class="pull-left" style="font-weight: bolder">{{ fengyacoin }}+{{ giftcoin }}</h3>
                    </div>
                    <div class="row">
                         <h5 class="pull-left">缝芽币+赠送</h5>
                    </div>
                    <br>
                    <div class="row">
                        <span> <a href="/coin/?type=5"><h5 class="pull-left">充值</h5></a>
                            <a id="concern" href="#" data-toggle="modal" data-target="#concernmodel"><h5 class="pull-left">(免费领取缝芽币)</h5></a></span>
                    </div>
                </div>
                 <div class="col-md-6">
                     <div class="row">
                     <h3 id="showgrate" class="pull-left" style="font-weight: bolder">{{ User.integrate }}</h3>
                     </div>
                     <div class="row">
                         <h5 class="pull-left">积分</h5>
                     </div>
                     <br>
                     <div class="row">
                        <a href="/credit/?type=6"><h5 class="pull-left">兑换</h5></a>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <br><br><br>
                <div class="row">
                    {% if signed == 0 %}
                        <a id="ajaxsign" class="btn btn-danger sign-button center-block" style="width:178px" href="#">签到</a>
                    {% elif signed == 1 %}
                        <a class="btn btn-danger sign-button center-block active" style="width:178px" href="#">已签到</a>
                    {% endif %}
                </div>
                 <br><br><br>
                 <div class="row">
                    <h4 id="signshow" class="text-center" style="font-weight: bolder">连续签到{{ User.keeplogin }}天</h4>
                </div>
            </div>
        </div>
        <br>
        <div class="row clearfix" style="height:100%;background-color: #FFFFFF;">
            <div class="col-md-12">
                <h3>我的信息</h3>
                <HR>
            </div>
            <div class="col-md-4">
                <h4 class="text-center">会员等级:普通会员</h4>
            </div>
            <div class="col-md-4">
                <h4 class="text-center">最近登录时间:{{ User.currnetlogindate | date:'Y-m-d' }}</h4>
            </div>
            <div class="col-md-4">
                <h4 class="text-center">注册时间:{{ User.registerdate | date:'Y-m-d' }}</h4>
            </div>

            <div class="col-md-12">
                <h3>账号安全</h3>
                <HR>
            </div>
            <!--div class="col-md-6">
                <h4 class="text-center">联系电话:{{ User.phonenum }}</h4>
            </div-->
            <div class="col-md-6" style="margin-top: 10px">
                <h4 class="text-center">注册邮箱:{{ User.identify }}</h4>
            </div>
            <!--div class="col-md-6" style="margin-top: 20px;">
                <a class="center-block text-center" style="width:178px" href="#" data-toggle="modal" data-target="#infomodel"><h3>修改手机</h3></a>
            </div-->

            <div class="col-md-6">
                <a class="center-block text-center" style="width:178px" href="#" data-toggle="modal" data-target="#infomodel"><h3>修改邮箱</h3></a>
            </div>
            <div class="modal fade" id="infomodel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					                                                                &times;
                            </button>
                            <h4 class="modal-title" id="myModalLabel">
                                信息修改
                            </h4>
                        </div>
                        <div class="modal-body">
                            该功能尚未实装，将在下一版本添加，谢谢您的支持，如有修改需要可以通过邮箱联系我们！
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal -->
            </div>

            <div class="col-md-12" style="margin-top: 20px;">
                <a class="btn sign-button center-block" style="width:178px" href="#" data-toggle="modal" data-target="#passwordmodel">修改密码</a>
            </div>

            <div class="col-md-12">
                <h3>绑定推广人</h3>
                <HR>
            </div>
            <div class="col-md-12">
                {% if isbind == 1 %}
                    <h4 class="text-center">恭喜您！已绑定推广人</h4>
                {% else %}
                    <div class="row">
                        <form class='form-login' action="/bind/" method="post">
                            {% csrf_token %}
                            <p class="form-group">
                                <span>{{ active_form.code.label_tag }}</span>
                                {{ active_form.code }}
                            </p>
                            <button type="submit" class="btn btn-primary center-block">绑定</button>
                        </form>
                    </div>
                    <div class="row">
                        <h5 class="text-center">欢迎您绑定推广人，绑定后将获得300积分！</h5>
                    </div>
                {% endif %}
            </div>

            <div class="col-md-12" style="height: 150px;margin-top: 30px;">
                <h2 class="text-center">敬请期待</h2>
            </div>
<!-- 模态框（Modal） -->
                <div class="modal fade" id="passwordmodel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                    &times;
                                </button>
                                <h4 class="modal-title" id="myModalLabel">
                                    修改密码
                                </h4>
                            </div>
                            <div class="modal-body">
                                <form class='form-login' action="/changepassword/" method="post">
                                    {% csrf_token %}
                                    <p class="form-group">
                                        <span> {{ ChangePwd_form.oldpassword.label_tag}}</span>
                                        {{ ChangePwd_form.oldpassword}}
                                     </p>
                                    <p class="form-group">
                                        <span>{{ ChangePwd_form.newpassword1.label_tag}}</span>
                                        {{ ChangePwd_form.newpassword1}}
                                    </p>
                                    <p class="form-group">
                                        <span>{{ ChangePwd_form.newpassword2.label_tag}}</span>
                                        {{ ChangePwd_form.newpassword2}}
                                    </p>
                                    <button type="submit" class="btn btn-primary center-block">提交</button>
                                </form>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal -->
                </div>
                        <div class="modal fade" id="picmodel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	                        <div class="modal-dialog">
		                        <div class="modal-content">
			                        <div class="modal-header">
				                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					                                                                &times;
                                        </button>
				                        <h4 class="modal-title" id="myModalLabel">
					                               上传头像
                                        </h4>
			                        </div>
			                        <div class="modal-body">
				                       该功能尚未实装，将在下一版本添加，谢谢您的支持！
			                        </div>
			                        <div class="modal-footer">
				                        <input id="input-1a" type="file" class="file" data-show-preview="false">
			                        </div>
		                        </div><!-- /.modal-content -->
	                        </div><!-- /.modal -->
                        </div>

                         <div class="modal fade" id="signmodel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	                        <div class="modal-dialog">
		                        <div class="modal-content">
			                        <div class="modal-header">
				                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					                                                                &times;
                                        </button>
				                        <h4 class="modal-title" id="myModalLabel">
					                               签到
                                        </h4>
			                        </div>
			                        <div class="modal-body">
				                       <div class="row clearfix">
                                           <h2 class="text-center">恭喜您！签到成功</h2>
                                       </div>
                                         <div class="row clearfix">
                                           <h4 class="text-center" id="keepday"></h4>
                                       </div>
			                        </div>
			                        <div class="modal-footer">
                                        <div class="row">
                                        <h4 class="pull-left" style="margin-left: 10px">签到规则</h4>
                                        </div>
                                        <div class="row">
                                        <h5 class="pull-left" style="margin-left: 10px">1、连续签到1到7天，每天可分别获得10、15、20、25、30、35、40积分；</h5>
                                        <h5 class="pull-left" style="margin-left: 10px">2、连续签到7天以上，每天固定获得40积分；</h5>
                                        <h5 class="pull-left" style="margin-left: 10px">3、若中间断签则连续签到归零，从第一天开始累积。</h5>
                                        <h5 class="pull-left" style="margin-left: 10px">4、签到规则及积分获取的最终解释权归属于石缝芽数据</h5>
                                        </div>
			                        </div>
		                        </div><!-- /.modal-content -->
	                        </div><!-- /.modal -->
                        </div>

                        <div class="modal fade" id="concernmodel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	                        <div class="modal-dialog">
		                        <div class="modal-content">
			                        <div class="modal-header">
				                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					                                                                &times;
                                        </button>
				                        <h4 class="modal-title" id="myModalLabel">
					                               关注微信号赠送缝芽币
                                        </h4>
			                        </div>
			                        <div class="modal-body">
                                        {% if isalready == 1 %}
                                            <div class="row clearfix">
                                                <h4 class="text-center">您今日已经领取过缝芽币，请明日再来领取！</h4>
                                            </div>
                                        {% elif isalready == 0 %}
				                       <div class="row clearfix">
                                           <h4 class="text-center">每日领取缝芽币步骤如下</h4>
                                       </div>
                                         <div class="row clearfix">
                                           <div class="col-md-6">
                                               <div class="row">
                                                    <h4 class="text-center"><strong>第一步：</strong>微信扫码关注公众号</h4>
                                                    <br/>
                                               </div>
                                                <div class="row center-block"style="text-align: center;">
                                                    <img src="{{ qrcodeurl }}" style="height:200px;width:200px;">
                                                    <h5 class="text-center">(已关注可以省略该步)</h5>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="row">
                                                    <h4 class="text-center"><strong>第二步：</strong>微信扫码授权领取缝芽币</h4>
                                                    <br/>
                                                </div>
                                                <div class="row center-block"style="text-align: center;">
                                                    <img src="{% static qrcodepath %}" style="height:200px;width:200px;">
                                                </div>
                                            </div>
                                            {% elif isalready == 2 %}
                                            <div class="row clearfix">
                                                <h4 class="text-center">恭喜您，您已经关注了目前全部公众号，今日可以直接点击下方链接免费领取缝芽币！</h4>
                                            </div>
                                            <div class="row clearfix center-block">
                                                <a class="center-block btn btn-primary class-button" href="/plat/allconcerncoin/">免费领取缝芽币</a>
                                            </div>
                                             {% else %}
                                                <div class="row clearfix">
                                                    <h4 class="text-center">对不起，未获取到相关信息，请您稍后重试或刷新页面！</h4>
                                                </div>
                                             {% endif %}
                                         </div>
			                        <div class="modal-footer">
                                        <div class="row">
                                        <h4 class="pull-left" style="margin-left: 10px">领取规则</h4>
                                        </div>
                                        <div class="row">
                                        <h5 class="pull-left" style="margin-left: 10px">1、每日扫码关注推荐公众号，可以领取5缝芽币；</h5>
                                        <h5 class="pull-left" style="margin-left: 10px">2、若您已关注该公众号，还未领取缝芽币，可以直接扫码领取；</h5>
                                        <h5 class="pull-left" style="margin-left: 10px">3、领取时需要关注微信授权验证，请您同意授权，否则无法领取；</h5>
                                        <h5 class="pull-left" style="margin-left: 10px">4、每日只能领取一次，系统自动限制，每日上午9点进行更新；</h5>
                                        <h5 class="pull-left" style="margin-left: 10px">5、赠送缝芽币仅可以购买文章及附件权限，不可兑换积分或交易；</h5>
                                        <h5 class="pull-left" style="margin-left: 10px">6、领取缝芽币的最终解释权归属于石缝芽数据。</h5>
                                        </div>
			                        </div>
		                        </div><!-- /.modal-content -->
	                        </div><!-- /.modal -->
                        </div>

                        <div class="modal fade" id="errorinfomodel" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	                        <div class="modal-dialog">
		                        <div class="modal-content">
			                        <div class="modal-header">
				                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					                                                                &times;
                                        </button>
				                        <h4 class="modal-title" id="myModalLabel">
					                               提示
                                        </h4>
			                        </div>
			                        <div class="modal-body">
                                        <h4 id="errorinfo" class="text-center"></h4>
			                        </div>
		                        </div><!-- /.modal-content -->
	                        </div><!-- /.modal -->
                        <div>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script type="text/javascript">
    $("#ajaxsign").click(function(){
        $.get("/sign/",{}, function(ret){
            if(ret == -1)
            {
               $("#errorinfo").text("您提交的信息不对，请重新登录后重试！");
               $('#errorinfomodel').modal('show');
            }
            else if(ret == -2)
            {
                $("#errorinfo").text("您尚未登录无法使用签到功能，请登录后重试");
                $('#errorinfomodel').modal('show');
            }
            else if(ret == 0)
            {
                $("#errorinfo").text("您今日已签到！");
                $('#errorinfomodel').modal('show');
            }
            else if(ret > 0)
            {
                $("#ajaxsign").addClass("active");
                $("#ajaxsign").text("已签到");

                var textsign = "连续签到"+ ret.toString() + "天";
                $("#signshow").text(textsign);

                var intergrate = 0;

                if(ret == 1)
                {
                    intergrate = 10;
                }
                else if(ret == 2)
                {
                    intergrate = 15;
                }
                else if(ret == 3)
                {
                    intergrate = 20;
                }
                else if(ret == 4)
                {
                    intergrate = 25;
                }
                else if(ret == 5)
                {
                    intergrate = 30;
                }
                else if(ret == 6)
                {
                    intergrate = 35;
                }
                else
                {
                    intergrate = 40;
                }

                var realgrate = {{ User.integrate }};
                realgrate += intergrate;
                $("#showgrate").text(realgrate.toString());

                var text = "连续签到"+ ret.toString() + "天,获得" + intergrate.toString()+ "积分。";
                $("#keepday").text(text);
                $('#signmodel').modal('show');
            }
        })
      });
    </script>
{% endblock %}
